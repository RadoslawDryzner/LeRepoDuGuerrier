<html>
<head>
	<meta charset="utf-8">
	<title>Dear lyrics</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link href="sheetArticle.css" rel="stylesheet">
	<link rel="icon" href="icon.ico">
</head>
<body>
	<div id="full-container">
        <h1> <b> Dear lyrics, what are you hiding ? </b> </h1>
		</br>
		<h3>19th December 2017</h3>
		</br>
		<h3>By Samuel P. Rey, Radosław P. Dryzner, and Arnaud V.J. Delamare</h3>
		</br>
		<p>Music is something we all enjoy across all cultures of the world. We all have many ideas about what kind of lyrics or phrases are often used in each genre, but in this project we look into the details of lyrics of many songs to find and vizualize interesting insights about them.</p>
		</br>
		<p>Usually, people associate pop songs to light, and happy themes such as love, and metal songs to darker themes, about death. With this project, you will be able to see if this is true !</p>
		<i>Spoiler alert, it is ;)</i>
		</br>
		</br>
        <h3><b> Methodology and Data </b></h3>
        <h4><b>Getting the data</b></h4>
		</br>
		</br>
		<p>The first thing we have to do is to obtain a list of songs. We used the <a href="https://labrosa.ee.columbia.edu/millionsong/">Million Song Dataset</a> (MSD), which, as its name implies, contains the data "for a million contemporary popular music tracks". This dataset contains a lot of useful information about each song, such as its popularity, its rythm, and many more features related to audio. As we only focus on the lyrics, and not the music, we use it to get the song name, the artist name and the year. However, we are missing two very important fields for our project : the genre of the song, and its lyrics, which are not in this dataset.</p>
		</br>
		<p>The genre of each song can be difficult to obtain as it depends on the definition of each genre, the perception of the listener and even on year of the song. Think about rock for instance : what was called <a href="https://www.youtube.com/watch?v=ZFo8-JqzSCM">rock in the 50's</a> is very different than what we call rock today. These problems, and the fact that the automatic tagging of a song is very difficult, explain why the <a href="https://labrosa.ee.columbia.edu/millionsong/blog/11-2-28-deriving-genre-dataset">Million Song Genre Dataset</a> only has 57.000 songs referenced in it. Nevertheless, we use this dataset to obtain the genres for this reduced set of songs.</p>
		</br>
        <p>For the lyrics, the Million Song Dataset also has a <a href="https://labrosa.ee.columbia.edu/millionsong/musixmatch">specific dataset</a> which provides a Bag Of Words (BOW) for each song. A BOW only provides a counter for each word in the text, indicating how many times this word is found in this particular text, therefore it does not provide any order for the words. However, for later analysis of the lyrics, a BOW is not enough and we must have the full lyrics. Thus we must get our hands dirty and get the lyrics ourselves. We first found two other datasets which contain lyrics for some songs in our dataset, but not all of them. We thus decided to parse <a href="https://genius.com/">Genius</a>, a website which provides lyrics for thousands of songs. </p>
        <p>
        First, we generate the URLs of the songs we are looking for in the format that Genius uses. These URLs might not be a perfect match, but work in most cases. We used <a href="https://scrapy.org/">Scrapy</a>, which takes the list of URLs we generate and visits every one of them, collecting the lyrics text from the replies it gets. With this method, we managed to get the lyrics for half of our songs, that is 22.000 lyrics.</p>
		<i>To the Genius team : if you saw a spike of traffic from Switzerland in the past few days, it was us ;)</i>
        </p>
		</br>
		</br>




        <h4><b> Processing the data </b></h4>
		</br>
		<p>Now that we have the lyrics and the genre for each song, we can start the processing the lyrics.</p>
		</br>
		<p>We process the lyrics in three ways :
			<ul>
				<li>Sentiment Analysis (getting a general estimate of the 'positivity' of the lyrics)</li>
				<li>Word Analysis (getting a BOW for each lyrics)</li>
				<li>Topic Analysis (getting the topics, or themes, of the lyrics)</li>
			</ul>
		</p>
		</br>
		<p>For all of these steps, we will use Natural Language Processing (NLP) methods, which enable us to automatically extract many features from the lyrics. However, the first step before using these NLP methods is to get the language of each song. We then got our first dilemma : should we keep songs that are not written in English ? The problem with keeping non-English lyrics is that it will decrease the quality of our NLP methods, as we will explain in the part about Topic Analysis. We could also process them separately from the English lyrics, but there are only a few songs that are not in English (less than 10%), so the results would not have been reliable. Thus we chose the least bad solution, which is to discard the non-English songs.</p>
		</br>
		<p>Now that we decided on what to do with these non-English songs, as there is no 'language' field in the dataset, we have to detect the language based on the lyrics. For this part, we used the well-named <a href="https://pypi.python.org/pypi/langdetect?">langdetect</a> library, which uses character N-grams (which are sequences of 1, 2, 3 or more letters), to determine the language of a text. For instance the 3-gram 'ght' is far more present in English than in French, but the inverse is true for the 3-gram 'eau'.</p>
		</br>
		<p>As we now have only English songs we can start the real processing, the first being the sentiment analysis !</p>
		</br>
		<p>The base for sentiment analysis in any text is supervised learning : you need to have a sample of texts, labelled with a number indicating its sentiment, a lower number is a negative sentiment and a higher one is a positive sentiment. Then, with this sample and labels, you can train a classifier, using any supervised learning technique, and then use this classifier to give a sentiment score to every text you want. Luckily for us <a href="http://textblob.readthedocs.io/en/dev/">TextBlob</a>, a famous python NLP library offers both the classifier and the data to train it. After the classifier has been trained, we can simply feed it each lyricis, and it will output its polarity (i.e positivity).</p>
		</br>


		<p>The next task is word analysis, which is the easiest of the three.</p>
		</br>
		<p>The goal of this analysis is to get a Bag Of Words (BOW) for each lyric. One can think that this task is trivial, as it only constits of splitting the lyrics by spaces, and getting the words, but it's more complicated. The first step for this task is the tokenization of the lyrics, that is transforming them in a list of words. This is done by taking into account spaces, tabs, line returns, ponctuation, etc. This is performed once again using TextBlob. </p>
		<p>The next step is the removal of the stop words. A stop word is a common word, which doesn't give very useful information, such as "I", "the", "that", etc. Even if these words can sometimes be useful, they are not for our purpose : we do not care about how often the word "the" is present in pop songs. </p>
		<p>Finally, the last step is the lemmatization. This consists of mapping each word to its "root" (also called "lemma"), by removing marks of plurals, tenses, etc. This is useful so that every instance of the same lemma will be grouped. For instance, the word "went" will be mapped to "go" and the word "elephants" will be mapped to "elephant".</p>
		</br>


		<p>The final task is topic analysis, the most complex.</p>
		</br>
		<p><i style="text-align: left;">First try :</i></p>
		<p>Our first approach concerning the topic analysis was to use a Latent Dirichlet Allocation (LDA) model to get the topics. This method is unsupervised : this means that it will try, given a sample of BOW of lyrics, and the number of topics, to guess to which topics each lyrics correspond. In this model, a topic is simply a distribution of words : for instance a topic about holidays could be : 0.1 * christmas + 0.05 * snow + 0.03 * love + 0.02 * family + ..., and a topic about hapiness would something like : 0.15 * joy + 0.1 * happy + 0.05 * love + ... Similarly, LDA assumes that each text (in our case lyrics), is built as a combination of topics. For instance, a song about happiness on holidays could be represented in this model as 0.5 * hapiness + 0.5 * holidays. Furthermore, this model does not output the name of each topic, this part is left to our human brains ;)</p>
		<p>We used <a href="https://www.scipy.org/">SciPy</a> to train and use our LDA model, EXPLIQUER BAD RESULTS + METTRE EXEMPLE</p>
		</br>
		<p><i style="text-align: left;">Second try :</i></p>
		<p>While coping with the deception about our LDA model, we looked for another method that could provide us with topics for our lyrics. After some searching we stumbled upon <a href="http://mallet.cs.umass.edu/">MALLET</a> (MAchine Learning for LanguagE Toolkit), which is a Java package that provides many tools for NLP, and topic modeling. The first 'difficulty' of using it is that, contrary to SciPy, MALLET is not a Python library, thus we first had to output each lyrics to a different file, which will be processed by MALLET. As before, we removed the stop words and the first names of people in the lyrics to get more accurate topics, but there is an important difference between LDA and MALLET's topic modeling : MALLET is not using a BOW, and keeps the sequence of words. This is why we must have the full lyrics and not simply use the BOW provided by the Million Song Dataset. Running MALLET on our preprocessed lyrics, as in the LDA model, outputs the decomposition, of each song between each topic.</p>
		<p>This time we got much better results with meaningful topics, which are described in the following table. Note that MALLET only outputs the list of words, and we had to manually infer the topic name.</p>

		<table class="table table-striped">
			<tr>
				<th>Topic</th>
				<th>List of words</th>
			</tr>
			<tr>
				<td>Other</td>
				<td> free ring set ding drop loose bomb dong jump killer cha turn mamma cut giddy agus control possibility siúil limbo</td>
			</tr>
			<tr>
				<td>Break-up</td>
				<td>heart cry leave break tear hurt lie feel make back goodbye stop pain save fall wrong die fool turn hold</td>
			</tr>
			<tr>
				<td>Friendship</td>
				<td>thing talk make people friend play good care time walk show remember call game guess smile bad face watch rea</td>
			</tr>
			<tr>
				<td>Music</td>
				<td>sing song hear heaven music play sound word shake call listen voice make world radio tune awake house guitar hum</td>
			</tr>
			<tr>
				<td>Nature</td>
				<td>river sea water wind mountain fly blow sail land tree grow green black young blue white ocean home high snow</td>
			</tr>
			<tr>
				<td>Feeling</td>
				<td>yeah feel wan ooh good tonight alright whoa make beautiful hey real baby high time feeling oooh turn show push</td>
			</tr>
			<tr>
				<td>AA vernacular</td>
				<td>dem man jah yuh woman gal babylon black gyal nuh nah yeh pon shy give hallelujah dis chorus youth agony</td>
			</tr>
			<tr>
				<td>Time</td>
				<td>time life make find world give mind live day change thing lose feel hard chorus long leave matter stay show</td>
			</tr>
			<tr>
				<td>Love</td>
				<td>hold sweet love mine kiss heart dream true make arm lover touch eye woman darling night forever blue give stay</td>
			</tr>
			<tr>
				<td>Daily life</td>
				<td>man money make hand put head work boy pay drink back big good buy gun poor eat kid woman house</td>
			</tr>
			<tr>
				<td>Life/Death</td>
				<td>life dead blood kill death end hate die soul hell mind lie human world pain control fear fuck flesh god</td>
			</tr>
			<tr>
				<td>Religion</td>
				<td>god child lord world soul people bear war mother land die brother man stand father peace men power holy fight</td>
			</tr>
			<tr>
				<td>Affection</td>
				<td>baby girl yeah bad wan make lovin doo babe thing man give bye darlin sugar hey pretty boy crazy fun</td>
			</tr>
			<tr>
				<td>Transport</td>
				<td>hey ride round city drive street car road wheel highway rid york air stop devil house place solid horse girl</td>
			</tr>
			<tr>
				<td>Weather</td>
				<td>night day light sun rain shine morning moon summer star blue christmas tonight bright shin winter dream time end bring</td>
			</tr>
			<tr>
				<td>Gangsta</td>
				<td>hot nigga fuck shit bop dog bitch real back jingle dub drop sex yall wan stuff top pop ahh bell</td>
			</tr>
			<tr>
				<td>Slang</td>
				<td>boy mama goin big lookin easy back nothin runnin comin good feelin bout livin doin walkin cryin talkin hard nice</td>
			</tr>
			<tr>
				<td>Dance</td>
				<td>dance move roll party shake ready music beat night body boogie stop rhythm wild gim groove hand floor make head</td>
			</tr>
			<tr>
				<td>Dream</td>
				<td>eye fall turn light dream feel fire burn watch face fly inside place close hear wall open stand lose run</td>
			</tr>
			<tr>
				<td>Loneliness</td>
				<td>home back long run walk time call train road wait lonely miss side leave bring day line write letter night</td>
			</tr>
		</table>
		<i>Results of runnig MALLET on our lyrics</i> </br>


		</br>
		</br>
        <h4> <b> Aggregating the data </b> </h4>
		</br>
		<p>Once the last step were done, we had, for each song : </p>
		<ul>
			<li>its name,</li>
			<li>its artist(s),</li>
			<li>its year,</li>
			<li>its genre,</li>
			<li>its positivity,</li>
			<li>a Bag Of Words, and</li>
			<li>a distribution of topics</li>
		</ul>
		<p>As our goal is to provide the variations of the sentiment/word frequency/topics based on the genre and year, we need to aggregate our data by genre and year. The precise details of this aggregation are better explained in our notebook, but essentialy we simply obtained the information we were looking for and grouped them by genre and year.</p>
		<p>Once this was done, we output, for each genre, a .csv file that contains the variations of the sentiments, and, for each word and topic another .csv file, that contains the variation of the use of this word/topic for the genre over the years.</p>


		</br>
		</br>
        <h4> <b> Visualizing the data </b> </h4>
		</br>

		<p>Finally, as our intent was to provide a way for everyone to explore our results, we created a simple but effective visualization of our data using <a href="https://d3js.org/">d3.js</a>, where you can select the data you want to look at and compare it with any other data in our database.</p>

		</br>
		</br>
        <h4> <b> Final pipeline </b> </h4>
		</br>
		<p>Our pipeline can be seen below : </p> 
		</br>
		<div class="mxgraph" style="border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;zoom&quot;:2,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile userAgent=\&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.91 Safari/537.36\&quot; version=\&quot;7.8.6\&quot; editor=\&quot;www.draw.io\&quot; type=\&quot;google\&quot;&gt;&lt;diagram id=\&quot;0f7a5766-fae5-5fe8-e982-401f255f3d96\&quot; name=\&quot;Page-1\&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;&quot;}"></div>
		<script type="text/javascript" src="https://www.draw.io/js/viewer.min.js"></script>

		</br>
		</br>
        <h3> <b> Results </b> </h3>
		</br>
		<p>In the following part, we will show you some results from our data.</p>
		</br>
		<img src="images/death-metalVSfolk.png"></img>
		<i>Frequency of the word 'death' in <span style="color:#66c2a5">Folk</span> and in <span style="color:#fc8d62">Metal</span></i> </br>
		</br>
		<p>We can see here, with no surprise, that the word 'death' is more present is Metal songs than in Folk songs.</p>
		<p> In the following visualization, you will be able to see trends in the words, topics and sentiments through time for the different genres : </p>
		<svg id="viz-svg"></svg>
		<div id=ui class="panel-group">
			<div id="curves-ui">
			</div>
			<button class="btn btn-success" id="btn-add"><span class="glyphicon glyphicon-plus"></span> Add data</button>
		</div>
		</br>
		<p>With this tool, you are able to select the word or topic you want, provided it is stored in our database, and compare its trend with any other word or topic.</p>
		<p>You can use it in full screen width <a href="fullViz.html">here</a>.</p>
		</br>
		</br>
        <h3> <b> What could be improved </b> </h3>
		</br>
		<p>Even if we have a fully working pipeline there is still room for improvement.</p>
		</br>
		<p>The main issue we currently have is that there's simply not enough songs. We started with 1.000.000 with the Million Song Dataset, which is more than enough, but by simply adding the genre with the MSD Genre dataset, this number drops to 57.000. Then, even if our method to get the lyrics works well, sometimes, the lyrics for a given song simply are not available on the web or on any dataset. We could have gotten more lyrics by using the MSD's Musixmatch dataset, but as we previously stated, this would have greatly reduced the quality of the topic modeling. Finally, we further reduced the number of songs to only keep the ones in English, which leaves us with 20.000 songs in the end.</p>
        <p>
        Thus a future work would focus on obtaining a larget dataset containing lyrics and our pipeline would output results that are even more interesting and robust.
        </p>
	</div>

	<div class="panel panel-default" id="curve-ui-template" style="display: none;">
		<table><tr><td>
		<div class="dropdown">
			<button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown"><span class="dropdown-text">Word</span>  <span class="caret"></span></button>
			<ul class="dropdown-menu">
				<li class="li-word"><a>Word</a></li>
				<li class="li-topic"><a>Topic</a></li>
				<li class="li-sentiment"><a>Sentiment</a></li>
			</ul>
		</div>
		</td><td>
		<span class="span-genre">  Genre :  </span>
		</td><td>
		<input type="text" class="form-control typeahead genre-typeahead" data-provide="typeahead">
		</td><td>
		<span class="span-word">  Word :  </span>
		</td><td>
		<input type="text" class="form-control typeahead word-typeahead" data-provide="typeahead">
		</td><td>
		<span class="span-topic">  Topic :  </span>
		</td><td>
		<input type="text" class="form-control typeahead topic-typeahead" data-provide="typeahead">
		</td><td>
		<span class="label label-danger label-no-data"><span class="glyphicon glyphicon-ban-circle"></span>  No data</span>
		</td><td class="full-width-td">
		<button class="btn btn-danger btn-remove"><span class="glyphicon glyphicon-remove"></span> Remove</button>
		</td></tr></table>
	</div>
	
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="bootstrap3-typeahead.min.js"></script>
	<script src="visu.js"></script>
</body>
</html>
