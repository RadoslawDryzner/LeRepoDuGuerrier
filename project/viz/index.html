<html>
<head>
	<meta charset="utf-8">
	<title>Dear lyrics</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link href="sheetArticle.css" rel="stylesheet">
	<link rel="icon" href="icon.ico">
</head>
<body>
	<div id="full-container">
		<h1> Dear lyrics, what are you hiding ?</h1>
		</br>
		<h3>19th December 2017</h3>
		</br>
		<h3>By Samuel P. Rey, Rados≈Çaw P. Dryzner, and Arnaud V.J. Delamare</h3>
		</br>
		<p>Music is something we all enjoy across all cultures of the world. We all have many ideas about what kind of lyrics or phrases are often used in each genre, but in this project we look into the details of lyrics of many songs to find and vizualize interesting insights about them.</p>
		</br>
		<p>Usually, people associate pop songs to light, and happy themes such as love, and metal songs to darker themes, about death. With this project, you will be able to see if this is true !</p>
		</br>
		<h3>Our method and data</h3>
		<h4>Getting the data</h4>
		</br>
		</br>
		<p>TODO : add samples, describe processing, add interesting results, add pipeline</p>
		</br>
		</br>
		<p>The first thing to work with songs is, well, a list of songs ! We used the <a href="https://labrosa.ee.columbia.edu/millionsong/">Million Song Dataset</a>, which, as its name implies, contains the data "for a million contemporary popular music tracks". This dataset contains many useful information about each song, such as its popularity, its rythm, and many more features related to audio. As we only focus on the lyrics, and not the music, we use it to get the song name, the artist name and the year. But we are still missing two very important fields for our project : the genre of the song, and its lyrics, which are not in this dataset.</p>
		</br>
		<p>The genre of each song can be difficult to obtain as it depends on the definition of each genre, the perception of the listener and even on year of the song. Think about rock for instance : what was called <a href="https://www.youtube.com/watch?v=ZFo8-JqzSCM">rock in the 50's</a> is very different than what we call rock today. These difficulties, and the fact that the automatic tagging of a song is very difficult, explain why the <a href="https://labrosa.ee.columbia.edu/millionsong/blog/11-2-28-deriving-genre-dataset">Million Song Genre Dataset</a> only has 59 000 songs referenced in it.</p>
		</br>
		<p>For the lyrics, the Million Song Dataset also has a <a href="https://labrosa.ee.columbia.edu/millionsong/musixmatch">specific dataset</a> which provides a Bag Of Words (BOW) for each song. A BOW only provides a counter for each word in the text, indicating how many times this word is found in this particular text, therefore it does not provide any order for the words. However, for later analysis of the lyrics, a BOW is not enough and we must have the full lyrics. Thus we must get our hands dirty and get the lyrics ourselves ! We first found two other datasets which contain lyrics for some songs in our dataset, but not nearly all of them. We thus decided to parse <a href="https://genius.com/">Genius</a>, a website which provides lyrics for thousands of songs EXPLIQUER PARSER. With this method, we managed to get the lyrics for half of our songs, that is 30 000 lyrics.</p>
		<i>To the Genius team : if you saw a spike of the traffic from Switzerland in the past few days, it was us ;)</i>
		</br>
		</br>




		<h4>Processing the data</h4>
		</br>
		<p>Now that we have the lyrics and the genre for each song, we can start the processing the lyrics !</p>
		</br>
		<p>We process the lyrics from three axes :
			<ul>
				<li>Sentiment Analysis (getting a general estimate of the 'positivity' of the lyrics)</li>
				<li>Word Analysis (getting a BOW for each lyrics)</li>
				<li>Topic Analysis (getting the topics, or themes, of the lyrics)</li>
			</ul>
		</p>
		</br>
		<p>For all of these steps, we will use Natural Language Processing (NLP) methods, which enable us to automatically extract from the lyrics many features. However, the first step before using these NLP methods is to get the language of each song. We then got our first dilemma : should we keep songs that are not in English ? The problem with keeping non-English lyrics is that it will decrease the quality of our NLP methods, as we will explain on the part about Topic Analysis. We could also process them separately from the English lyrics, but there are only a few songs that are not in English (less than 10%), so the results would not have been reliable. Thus we chose the least bad solution, which is to discard the non-English songs.</p>
		</br>
		<p>Now that we decided on what to do with these non-English songs, as there is no 'language' field in the dataset, we have to detect the language based on the lyrics. For this part, we used the well-named <a href="https://pypi.python.org/pypi/langdetect?">langdetect</a> library, which uses character N-grams (which are sequences of 1, 2, 3 or more letters), to determine the language of a text. For instance the 3-gram 'ght' is far more present in English than in French, but the inverse is true for the 3-gram 'eau'.</p>
		</br>
		<p>As that we now have only English songs we can start the real processing, the first being the sentiment analysis !</p>
		</br>
		<p>The base for sentiment analysis in any text is supervised learning : you need to have a sample of texts, labelled with a number indicating its sentiment, a lower number is a negative sentiment and a higher one is a positive sentiment. Then, with this sample and labels, you can train a classifier, using any supervised learning technique, and then use this classifier to give a sentiment score to every text you want. Luckily for us <a href="http://textblob.readthedocs.io/en/dev/">TextBlob</a>, a famous python NLP library offers both the classifier and the data to train it. After the classifier has been trained, we can simply feed it each lyric, and it will output its polarity (i.e positivity).</p>
		</br>


		<p>The next task is word analysis, which is the easiest of the three.</p>
		</br>
		<p>The goal of this analysis is to get a Bag Of Words (BOW) for each lyric. One can think that this task is trivial, as it only constits of splitting the lyrics by spaces, and getting the words, but it's more complicated. The first step for this task is the tokenization of the lyrics, that is transforming them in a list of words This is done by taking into account spaces, tabs, line returns, ponctuation, etc. This is performed once again using TextBlob. </p>
		<p>The next step is the removal of the stop words. "What is a stop word ?", you might ask : a stop word is a common word, which doesn't give very useful information, such as "I", "the", "that", etc. Even if these words can sometimes be useful, they are not for our purpose : we do not care about how often the word "the" is present in pop songs. </p>
		<p>Finally, the last step is the lemmatization. This consists of mapping each word to its "root" (also called "lemma"), by removing marks of plurals, tenses, etc. This is useful so that every instance of the same lemma will be grouped. For instance, the word "went" will be mapped to "go" and the word "elephants" will be mapped to "elephant".</p>
		</br>


		<p>The final task is topic analysis, the most complex.</p>
		</br>
		<p><i style="text-align: left;">First try :</i></p>
		<p>Our first approach concerning the topic analysis was to use a Latent Dirichlet Allocation (LDA) model to get the topics. This method is unsupervised : this means that it will try, given a sample of BOW of lyrics, and the number of topics, to guess the to which topics each lyrics correspond. In this model, a topic is simply a distribution of words : for instance a topic about holidays could be : 0.1 * christmas + 0.05 * snow + 0.03 * love + 0.02 * family + ..., and a topic about hapiness would something like : 0.15 * joy + 0.1 * happy + 0.05 * love + ... Similarly, LDA assumes that each text (in our case lyrics), is built as a combination of topics. For instance, a song about happiness on holidays could be represented in this model as 0.5 * hapiness + 0.5 * holidays. Furthermore, this model does not output the name of each topic, this part is left to our human brains ;)</p>
		<p>We used <a href="https://www.scipy.org/">SciPy</a> to train and use our LDA model, EXPLIQUER BAD RESULTS + METTRE EXEMPLE</p>
		</br>
		<p><i style="text-align: left;">Second try :</i></p>
		<p>While coping with the deception about our LDA model, we looked for another method that could provide us with topics for our lyrics. After some searching we stumbled upon <a href="http://mallet.cs.umass.edu/">MALLET</a> (MAchine Learning for LanguagE Toolkit), which is a Java package that provides many tools for NLP, and topic modeling. The first 'difficulty' of using it is that, contrary to SciPy, MALLET is not a python library, thus we first had to output each lyrics to a different file, which will be processed by MALLET. As before, we removed the stop words and the first names of the lyrics to get more accurate topics, but there is an important difference between LDA and MALLET's topic modeling : MALLET is not using a BOW, and keeps the sequence of words. This is why we must have the full lyrics and not simply use the BOW provided by the Million Songs Dataset. Running MALLET on our preprocessed lyrics outputs, as in the LDA model, the decomposition, of each song between each topics.</p>
		<p>This time we got much better results, and meaningful topics METTRE EXEMPLE</p>



		</br>
		</br>
		<h4>Aggregating the data</h4>
		</br>
		<p>Once the last step were done, we had, for each song : </p>
		<ul>
			<li>its name,</li>
			<li>its artist(s),</li>
			<li>its year,</li>
			<li>its genre,</li>
			<li>its positivity,</li>
			<li>a Bag Of Words, and</li>
			<li>a distribution of topics</li>
		</ul>
		<p>As our goal is to provide the variations of the sentiment/words/topics based on the genre and year, we need to aggregate our data by genre and year. METTRE DETAILS</p>
		<p>Once this was done, we output, for each genre, a .csv file that contains the variations of the sentiments, and, for each word and topic another .csv file, that contains the variation of the use of this word/topic for the genre over the years.</p>


		</br>
		</br>
		<h4>Visualizing the data</h4>
		</br>

		<p>Finally, as our intent was to provide a way for everyone to explore our results, we created a simple but effective visualization of our data using <a href="https://d3js.org/">d3.js</a>, where you can select the data you want to look at and compare it with any other data in our database.</p>

		</br>
		</br>
		<h3>Our results</h3>
		</br>
		<p> In the following visualization, you will be able to see trends in the words, topics and sentiments through time for the different genres : </p>
		<svg></svg>
		<div id=ui class="panel-group">
			<div id="curves-ui">
			</div>
			<button class="btn btn-success" id="btn-add"><span class="glyphicon glyphicon-plus"></span> Add data</button>
		</div>
		</br>
		<p>With this tool, you are able to select the word or topic you want, provided it is stored in our database, and compare its trend with any other word or topic.</p>
		<p>You can use it in full size <a href="fullViz.html">here</a>.</p>
		</br>
		</br>
		<h3>What could be improved</h3>
	</div>

	<div class="panel panel-default" id="curve-ui-template" style="display: none;">
		<table><tr><td>
		<div class="dropdown">
			<button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown"><span class="dropdown-text">Word</span>  <span class="caret"></span></button>
			<ul class="dropdown-menu">
				<li class="li-word"><a>Word</a></li>
				<li class="li-topic"><a>Topic</a></li>
				<li class="li-sentiment"><a>Sentiment</a></li>
			</ul>
		</div>
		</td><td>
		<span class="span-genre">  Genre :  </span>
		</td><td>
		<input type="text" class="form-control typeahead genre-typeahead" data-provide="typeahead">
		</td><td>
		<span class="span-word">  Word :  </span>
		</td><td>
		<input type="text" class="form-control typeahead word-typeahead" data-provide="typeahead">
		</td><td>
		<span class="span-topic">  Topic :  </span>
		</td><td>
		<input type="text" class="form-control typeahead topic-typeahead" data-provide="typeahead">
		</td><td>
		<span class="label label-danger label-no-data"><span class="glyphicon glyphicon-ban-circle"></span>  No data</span>
		</td><td class="full-width-td">
		<button class="btn btn-danger btn-remove"><span class="glyphicon glyphicon-remove"></span> Remove</button>
		</td></tr></table>
	</div>
	
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="bootstrap3-typeahead.min.js"></script>
	<script src="visu.js"></script>
</body>
</html>